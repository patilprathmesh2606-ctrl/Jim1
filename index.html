<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Royal Kitchen - Complete System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50">

<!-- Setup Guide Modal -->
<div id="setupGuide" class="fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-xl max-w-4xl max-h-[90vh] overflow-y-auto p-8">
        <h2 class="text-3xl font-bold mb-6 text-red-600">üöÄ Setup Instructions</h2>
        
        <div class="space-y-6">
            <div class="bg-blue-50 p-4 rounded-lg">
                <h3 class="font-bold text-lg mb-2">üì¶ This is a DEMO version with full features</h3>
                <p class="text-sm">All data is stored in browser memory. For production:</p>
            </div>

            <div class="border-l-4 border-green-500 pl-4">
                <h3 class="font-bold mb-2">1Ô∏è‚É£ Supabase Setup (Database)</h3>
                <ol class="text-sm space-y-2 list-decimal list-inside">
                    <li>Create account at <a href="https://supabase.com" target="_blank" class="text-blue-600 underline">supabase.com</a></li>
                    <li>Create new project</li>
                    <li>Get URL & Key from Settings ‚Üí API</li>
                    <li>Run SQL in SQL Editor (provided in code comments)</li>
                </ol>
            </div>

            <div class="border-l-4 border-orange-500 pl-4">
                <h3 class="font-bold mb-2">2Ô∏è‚É£ Firebase Setup (Image Storage)</h3>
                <ol class="text-sm space-y-2 list-decimal list-inside">
                    <li>Create project at <a href="https://console.firebase.google.com" target="_blank" class="text-blue-600 underline">Firebase Console</a></li>
                    <li>Enable Storage</li>
                    <li>Get config from Project Settings</li>
                    <li>Update storage rules (provided in code)</li>
                </ol>
            </div>

            <div class="bg-yellow-50 p-4 rounded-lg">
                <h3 class="font-bold mb-2">‚ú® Features Included:</h3>
                <div class="grid grid-cols-2 gap-2 text-sm">
                    <div>‚úÖ User Management</div>
                    <div>‚úÖ Role-based Access</div>
                    <div>‚úÖ Add/Edit/Delete Dishes</div>
                    <div>‚úÖ Image Upload</div>
                    <div>‚úÖ Table Reservations</div>
                    <div>‚úÖ Order Management</div>
                    <div>‚úÖ Table-wise History</div>
                    <div>‚úÖ Name-wise History</div>
                    <div>‚úÖ 7 Custom Permissions</div>
                    <div>‚úÖ Responsive Design</div>
                </div>
            </div>

            <div class="bg-gray-100 p-4 rounded-lg">
                <h3 class="font-bold mb-2">üîë Demo Credentials:</h3>
                <div class="font-mono text-sm space-y-1">
                    <div><strong>Admin:</strong> admin@royalkitchen.com / admin123</div>
                    <div><strong>Manager:</strong> john@royalkitchen.com / manager123</div>
                    <div><strong>Waiter:</strong> sarah@royalkitchen.com / waiter123</div>
                    <div><strong>Chef:</strong> mike@royalkitchen.com / chef123</div>
                </div>
            </div>
        </div>

        <button onclick="closeSetupGuide()" class="mt-6 w-full bg-red-600 text-white py-3 rounded-lg hover:bg-red-700 font-bold">
            Start Using Demo ‚Üí
        </button>
    </div>
</div>

<!-- Login Screen -->
<div id="loginScreen" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-red-50 to-amber-50 p-4">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-8">
        <div class="text-center mb-8">
            <div class="w-20 h-20 mx-auto mb-4 bg-gradient-to-br from-red-600 to-amber-600 rounded-full flex items-center justify-center">
                <i class="fas fa-utensils text-white text-3xl"></i>
            </div>
            <h1 class="text-3xl font-bold text-gray-800">The Royal Kitchen</h1>
            <p class="text-gray-600 mt-2">Restaurant Management System</p>
        </div>

        <div class="space-y-4">
            <input type="email" id="loginEmail" value="admin@royalkitchen.com" placeholder="Email"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
            <input type="password" id="loginPassword" value="admin123" placeholder="Password"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500">
            <button onclick="handleLogin()" class="w-full bg-gradient-to-r from-red-600 to-amber-600 text-white py-3 rounded-lg font-medium hover:from-red-700 hover:to-amber-700">
                Login
            </button>
            <button onclick="document.getElementById('setupGuide').classList.remove('hidden')" class="w-full text-sm text-blue-600 hover:underline">
                View Setup Guide
            </button>
        </div>
    </div>
</div>

<!-- Main Dashboard (hidden initially) -->
<div id="mainDashboard" class="hidden min-h-screen">
    <header class="bg-gradient-to-r from-red-700 to-amber-700 text-white py-4 shadow-xl sticky top-0 z-40">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold"><i class="fas fa-utensils mr-2"></i>The Royal Kitchen</h1>
                <p class="text-sm text-red-100"><span id="userName"></span> ‚Ä¢ <span id="userRole"></span></p>
            </div>
            <button onclick="handleLogout()" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg">
                <i class="fas fa-sign-out-alt mr-2"></i>Logout
            </button>
        </div>
    </header>

    <nav class="bg-white shadow sticky top-16 z-30">
        <div class="container mx-auto px-4 py-3 flex gap-2 overflow-x-auto" id="navMenu"></div>
    </nav>

    <main class="container mx-auto px-4 py-8">
        <div id="viewDashboard" class="view">
            <h2 class="text-2xl font-bold mb-6">Dashboard</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <div class="flex justify-between items-center">
                        <div><p class="text-gray-600 text-sm">Users</p><p class="text-3xl font-bold" id="statUsers">0</p></div>
                        <i class="fas fa-users text-4xl text-blue-500"></i>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <div class="flex justify-between items-center">
                        <div><p class="text-gray-600 text-sm">Dishes</p><p class="text-3xl font-bold" id="statDishes">0</p></div>
                        <i class="fas fa-utensils text-4xl text-green-500"></i>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <div class="flex justify-between items-center">
                        <div><p class="text-gray-600 text-sm">Orders</p><p class="text-3xl font-bold" id="statOrders">0</p></div>
                        <i class="fas fa-receipt text-4xl text-purple-500"></i>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <div class="flex justify-between items-center">
                        <div><p class="text-gray-600 text-sm">Revenue</p><p class="text-3xl font-bold" id="statRevenue">‚Çπ0</p></div>
                        <i class="fas fa-rupee-sign text-4xl text-amber-500"></i>
                    </div>
                </div>
            </div>
        </div>

        <div id="viewUsers" class="view hidden">
            <div class="flex justify-between mb-6">
                <h2 class="text-2xl font-bold">Users</h2>
                <button onclick="showModal('user')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    <i class="fas fa-plus mr-2"></i>Add User
                </button>
            </div>
            <div id="usersList" class="space-y-4"></div>
        </div>

        <div id="viewDishes" class="view hidden">
            <div class="flex justify-between mb-6">
                <h2 class="text-2xl font-bold">Dishes</h2>
                <button onclick="showModal('dish')" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                    <i class="fas fa-plus mr-2"></i>Add Dish
                </button>
            </div>
            <div id="dishesList" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
        </div>

        <div id="viewReservations" class="view hidden">
            <div class="flex justify-between mb-6">
                <h2 class="text-2xl font-bold">Reservations</h2>
                <button onclick="showModal('reservation')" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                    <i class="fas fa-plus mr-2"></i>New Reservation
                </button>
            </div>
            <div id="reservationsList" class="space-y-4"></div>
        </div>

        <div id="viewOrders" class="view hidden">
            <div class="flex justify-between mb-6">
                <h2 class="text-2xl font-bold">Orders - Table View</h2>
                <input type="text" id="orderSearch" placeholder="Search table..." oninput="renderOrders()" class="px-4 py-2 border rounded-lg">
            </div>
            <div id="ordersList" class="space-y-4"></div>
        </div>

        <div id="viewHistory" class="view hidden">
            <div class="mb-6">
                <h2 class="text-2xl font-bold mb-4">Order History</h2>
                <div class="flex gap-4">
                    <button onclick="historyFilter='table';renderHistory()" id="btnTable" class="px-4 py-2 bg-blue-600 text-white rounded-lg">By Table</button>
                    <button onclick="historyFilter='name';renderHistory()" id="btnName" class="px-4 py-2 bg-gray-300 rounded-lg">By Name</button>
                    <input type="text" id="historySearch" placeholder="Search..." oninput="renderHistory()" class="flex-1 px-4 py-2 border rounded-lg">
                </div>
            </div>
            <div id="historyList" class="space-y-4"></div>
        </div>
    </main>
</div>

<!-- Modals -->
<div id="modalUser" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl p-8 w-full max-w-md">
        <h3 class="text-2xl font-bold mb-6">Add User</h3>
        <div class="space-y-4">
            <input id="userName" type="text" placeholder="Name" class="w-full px-4 py-2 border rounded-lg">
            <input id="userEmail" type="email" placeholder="Email" class="w-full px-4 py-2 border rounded-lg">
            <input id="userPhone" type="tel" placeholder="Phone" class="w-full px-4 py-2 border rounded-lg">
            <select id="userRole" class="w-full px-4 py-2 border rounded-lg">
                <option value="waiter">Waiter</option>
                <option value="chef">Chef</option>
                <option value="manager">Manager</option>
            </select>
            <input id="userPassword" type="password" placeholder="Password" class="w-full px-4 py-2 border rounded-lg">
            <div class="flex gap-3">
                <button onclick="saveUser()" class="flex-1 bg-blue-600 text-white py-2 rounded-lg">Save</button>
                <button onclick="closeModal()" class="flex-1 bg-gray-300 py-2 rounded-lg">Cancel</button>
            </div>
        </div>
    </div>
</div>

<div id="modalDish" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl p-8 w-full max-w-md">
        <h3 class="text-2xl font-bold mb-6"><span id="dishTitle">Add</span> Dish</h3>
        <div class="space-y-4">
            <input type="hidden" id="dishId">
            <input id="dishName" type="text" placeholder="Dish Name" class="w-full px-4 py-2 border rounded-lg">
            <select id="dishCategory" class="w-full px-4 py-2 border rounded-lg">
                <option value="chinese">Chinese</option>
                <option value="fastfood">Fast Food</option>
                <option value="drinks">Drinks</option>
                <option value="soups">Soups</option>
            </select>
            <input id="dishPrice" type="number" placeholder="Price" class="w-full px-4 py-2 border rounded-lg">
            <textarea id="dishDesc" placeholder="Description" rows="2" class="w-full px-4 py-2 border rounded-lg"></textarea>
            <input id="dishImage" type="file" accept="image/*" class="w-full px-4 py-2 border rounded-lg">
            <div class="flex gap-3">
                <button onclick="saveDish()" class="flex-1 bg-green-600 text-white py-2 rounded-lg">Save</button>
                <button onclick="closeModal()" class="flex-1 bg-gray-300 py-2 rounded-lg">Cancel</button>
            </div>
        </div>
    </div>
</div>

<div id="modalReservation" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl p-8 w-full max-w-md">
        <h3 class="text-2xl font-bold mb-6">New Reservation</h3>
        <div class="space-y-4">
            <input id="resName" type="text" placeholder="Customer Name" class="w-full px-4 py-2 border rounded-lg">
            <input id="resPhone" type="tel" placeholder="Phone" class="w-full px-4 py-2 border rounded-lg">
            <input id="resDate" type="date" class="w-full px-4 py-2 border rounded-lg">
            <input id="resTime" type="time" class="w-full px-4 py-2 border rounded-lg">
            <input id="resGuests" type="number" placeholder="Guests" value="2" class="w-full px-4 py-2 border rounded-lg">
            <select id="resTable" class="w-full px-4 py-2 border rounded-lg"></select>
            <div class="flex gap-3">
                <button onclick="saveReservation()" class="flex-1 bg-purple-600 text-white py-2 rounded-lg">Save</button>
                <button onclick="closeModal()" class="flex-1 bg-gray-300 py-2 rounded-lg">Cancel</button>
            </div>
        </div>
    </div>
</div>

<script>
let currentUser = null,
    users = [],
    dishes = [],
    orders = [],
    reservations = [],
    tables = [],
    historyFilter = 'table';

function init() {
    users = [{
        id: '1',
        name: 'Admin',
        email: 'admin@royalkitchen.com',
        role: 'admin',
        isActive: true,
        permissions: {
            addDish: true,
            editDish: true,
            deleteDish: true,
            reserveTable: true,
            viewTableOrders: true,
            viewOrderHistory: true,
            viewByName: true
        }
    }, {
        id: '2',
        name: 'John Manager',
        email: 'john@royalkitchen.com',
        role: 'manager',
        isActive: true,
        permissions: {
            addDish: true,
            editDish: true,
            deleteDish: false,
            reserveTable: true,
            viewTableOrders: true,
            viewOrderHistory: true,
            viewByName: true
        }
    }, {
        id: '3',
        name: 'Sarah Waiter',
        email: 'sarah@royalkitchen.com',
        role: 'waiter',
        isActive: true,
        permissions: {
            addDish: false,
            editDish: false,
            deleteDish: false,
            reserveTable: true,
            viewTableOrders: true,
            viewOrderHistory: false,
            viewByName: false
        }
    }, {
        id: '4',
        name: 'Mike Chef',
        email: 'mike@royalkitchen.com',
        role: 'chef',
        isActive: true,
        permissions: {
            addDish: false,
            editDish: false,
            deleteDish: false,
            reserveTable: false,
            viewTableOrders: true,
            viewOrderHistory: false,
            viewByName: false
        }
    }];
    
    dishes = [{
        id: 'd1',
        name: 'Kung Pao Chicken',
        category: 'chinese',
        price: 320,
        description: 'Spicy stir-fried chicken',
        imageUrl: 'https://images.unsplash.com/photo-1563245372-f21724e3856d?w=300',
        isActive: true
    }, {
        id: 'd2',
        name: 'Dragon Burger',
        category: 'fastfood',
        price: 220,
        description: 'Special chicken burger',
        imageUrl: 'https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=300',
        isActive: true
    }, {
        id: 'd3',
        name: 'Mango Lassi',
        category: 'drinks',
        price: 100,
        description: 'Sweet mango yogurt',
        imageUrl: 'https://images.unsplash.com/photo-1629367494173-c78a56567877?w=300',
        isActive: true
    }];
    
    orders = [{
        id: 'o1',
        orderNumber: 'ORD-001',
        tableNumber: 3,
        customerName: 'John Doe',
        customerPhone: '+919876543210',
        items: [{
            name: 'Kung Pao Chicken',
            price: 320,
            quantity: 2
        }],
        total: 640,
        status: 'preparing',
        createdAt: new Date().toISOString()
    }];
    
    tables = Array.from({length: 15}, (_, i) => ({
        id: `t${i+1}`,
        number: i + 1,
        capacity: i < 5 ? 2 : i < 10 ? 4 : 6,
        status: 'free'
    }));
    
    reservations = [{
        id: 'r1',
        tableNumber: 5,
        customerName: 'Alice Brown',
        customerPhone: '+919876543212',
        date: '2024-01-25',
        time: '19:00',
        guestCount: 4,
        status: 'confirmed'
    }];
    
    updateStats();
}

function closeSetupGuide() {
    document.getElementById('setupGuide').classList.add('hidden');
}

function handleLogin() {
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    const user = users.find(u => u.email === email);
    
    if (user) {
        // In a real app, you should verify password
        currentUser = user;
        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('mainDashboard').classList.remove('hidden');
        document.getElementById('userName').textContent = user.name;
        document.getElementById('userRole').textContent = user.role.toUpperCase();
        setupNav();
        showView('dashboard');
        alert('‚úì Login successful!');
    } else {
        alert('‚úó Invalid credentials');
    }
}

function handleLogout() {
    currentUser = null;
    document.getElementById('mainDashboard').classList.add('hidden');
    document.getElementById('loginScreen').classList.remove('hidden');
}

function hasPermission(p) {
    return currentUser?.role === 'admin' || currentUser?.permissions?.[p];
}

function setupNav() {
    let nav = '<button onclick="showView(\'dashboard\')" class="px-4 py-2 rounded-lg hover:bg-gray-100"><i class="fas fa-home mr-2"></i>Dashboard</button>';
    
    if (currentUser.role === 'admin') {
        nav += '<button onclick="showView(\'users\')" class="px-4 py-2 rounded-lg hover:bg-gray-100"><i class="fas fa-users mr-2"></i>Users</button>';
    }
    
    if (hasPermission('addDish')) {
        nav += '<button onclick="showView(\'dishes\')" class="px-4 py-2 rounded-lg hover:bg-gray-100"><i class="fas fa-utensils mr-2"></i>Dishes</button>';
    }
    
    if (hasPermission('reserveTable')) {
        nav += '<button onclick="showView(\'reservations\')" class="px-4 py-2 rounded-lg hover:bg-gray-100"><i class="fas fa-calendar mr-2"></i>Reservations</button>';
    }
    
    if (hasPermission('viewTableOrders')) {
        nav += '<button onclick="showView(\'orders\')" class="px-4 py-2 rounded-lg hover:bg-gray-100"><i class="fas fa-clipboard-list mr-2"></i>Orders</button>';
    }
    
    if (hasPermission('viewOrderHistory')) {
        nav += '<button onclick="showView(\'history\')" class="px-4 py-2 rounded-lg hover:bg-gray-100"><i class="fas fa-history mr-2"></i>History</button>';
    }
    
    document.getElementById('navMenu').innerHTML = nav;
}

function showView(v) {
    document.querySelectorAll('.view').forEach(el => el.classList.add('hidden'));
    document.getElementById('view' + v.charAt(0).toUpperCase() + v.slice(1)).classList.remove('hidden');
    
    if (v === 'users') renderUsers();
    if (v === 'dishes') renderDishes();
    if (v === 'orders') renderOrders();
    if (v === 'reservations') renderReservations();
    if (v === 'history') renderHistory();
}

function updateStats() {
    document.getElementById('statUsers').textContent = users.length;
    document.getElementById('statDishes').textContent = dishes.filter(d => d.isActive).length;
    document.getElementById('statOrders').textContent = orders.length;
    document.getElementById('statRevenue').textContent = '‚Çπ' + orders.reduce((sum, o) => sum + o.total, 0);
}

function showModal(type) {
    document.getElementById('modal' + type.charAt(0).toUpperCase() + type.slice(1)).classList.remove('hidden');
    
    if (type === 'reservation') {
        let opts = '<option value="">Select Table</option>';
        tables.forEach(t => {
            opts += `<option value="${t.number}">Table ${t.number} (${t.capacity} seats)</option>`;
        });
        document.getElementById('resTable').innerHTML = opts;
        
        // Set default date to tomorrow
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        document.getElementById('resDate').value = tomorrow.toISOString().split('T')[0];
    }
}

function closeModal() {
    document.querySelectorAll('[id^="modal"]').forEach(el => el.classList.add('hidden'));
}

function saveUser() {
    const id = 'u' + Date.now();
    const user = {
        id: id,
        name: document.getElementById('userName').value,
        email: document.getElementById('userEmail').value,
        phone: document.getElementById('userPhone').value,
        role: document.getElementById('userRole').value,
        password: document.getElementById('userPassword').value,
        isActive: true,
        permissions: {}
    };
    
    // Set default permissions based on role
    if (user.role === 'manager') {
        user.permissions = {
            addDish: true,
            editDish: true,
            deleteDish: false,
            reserveTable: true,
            viewTableOrders: true,
            viewOrderHistory: true,
            viewByName: true
        };
    } else if (user.role === 'waiter') {
        user.permissions = {
            addDish: false,
            editDish: false,
            deleteDish: false,
            reserveTable: true,
            viewTableOrders: true,
            viewOrderHistory: false,
            viewByName: false
        };
    } else if (user.role === 'chef') {
        user.permissions = {
            addDish: false,
            editDish: false,
            deleteDish: false,
            reserveTable: false,
            viewTableOrders: true,
            viewOrderHistory: false,
            viewByName: false
        };
    }
    
    users.push(user);
    closeModal();
    renderUsers();
    updateStats();
    alert('User added successfully!');
}

function renderUsers() {
    let html = '';
    users.forEach(user => {
        html += `
            <div class="bg-white p-4 rounded-xl shadow">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="font-bold">${user.name}</h3>
                        <p class="text-gray-600 text-sm">${user.email} ‚Ä¢ ${user.role.toUpperCase()}</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="toggleUser('${user.id}')" class="px-3 py-1 ${user.isActive ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'} rounded">
                            ${user.isActive ? 'Active' : 'Inactive'}
                        </button>
                        ${currentUser.role === 'admin' ? `<button onclick="deleteUser('${user.id}')" class="px-3 py-1 bg-red-600 text-white rounded">Delete</button>` : ''}
                    </div>
                </div>
            </div>
        `;
    });
    document.getElementById('usersList').innerHTML = html;
}

function toggleUser(id) {
    const user = users.find(u => u.id === id);
    if (user) {
        user.isActive = !user.isActive;
        renderUsers();
    }
}

function deleteUser(id) {
    if (confirm('Are you sure you want to delete this user?')) {
        users = users.filter(u => u.id !== id);
        renderUsers();
        updateStats();
    }
}

function renderDishes() {
    let html = '';
    dishes.forEach(dish => {
        if (!dish.isActive) return;
        html += `
            <div class="bg-white rounded-xl shadow overflow-hidden">
                <img src="${dish.imageUrl}" alt="${dish.name}" class="w-full h-48 object-cover">
                <div class="p-4">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-bold text-lg">${dish.name}</h3>
                            <p class="text-gray-600 text-sm">${dish.description}</p>
                        </div>
                        <span class="font-bold text-lg">‚Çπ${dish.price}</span>
                    </div>
                    <div class="flex justify-between mt-4">
                        <span class="px-3 py-1 bg-gray-100 rounded-full text-sm">${dish.category}</span>
                        <div class="flex gap-2">
                            ${hasPermission('editDish') ? `<button onclick="editDish('${dish.id}')" class="px-3 py-1 bg-blue-100 text-blue-700 rounded">Edit</button>` : ''}
                            ${hasPermission('deleteDish') ? `<button onclick="deleteDish('${dish.id}')" class="px-3 py-1 bg-red-100 text-red-700 rounded">Delete</button>` : ''}
                        </div>
                    </div>
                </div>
            </div>
        `;
    });
    document.getElementById('dishesList').innerHTML = html;
}

function saveDish() {
    const id = document.getElementById('dishId').value || 'd' + Date.now();
    const dish = {
        id: id,
        name: document.getElementById('dishName').value,
        category: document.getElementById('dishCategory').value,
        price: parseFloat(document.getElementById('dishPrice').value),
        description: document.getElementById('dishDesc').value,
        imageUrl: 'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=300', // Default image
        isActive: true
    };
    
    if (id.startsWith('d')) {
        const index = dishes.findIndex(d => d.id === id);
        if (index !== -1) {
            dishes[index] = dish;
        }
    } else {
        dishes.push(dish);
    }
    
    closeModal();
    renderDishes();
    updateStats();
    alert('Dish saved successfully!');
}

function editDish(id) {
    const dish = dishes.find(d => d.id === id);
    if (dish) {
        document.getElementById('dishId').value = dish.id;
        document.getElementById('dishName').value = dish.name;
        document.getElementById('dishCategory').value = dish.category;
        document.getElementById('dishPrice').value = dish.price;
        document.getElementById('dishDesc').value = dish.description;
        document.getElementById('dishTitle').textContent = 'Edit';
        showModal('dish');
    }
}

function deleteDish(id) {
    if (confirm('Are you sure you want to delete this dish?')) {
        const dish = dishes.find(d => d.id === id);
        if (dish) dish.isActive = false;
        renderDishes();
        updateStats();
    }
}

function saveReservation() {
    const id = 'r' + Date.now();
    const reservation = {
        id: id,
        tableNumber: parseInt(document.getElementById('resTable').value),
        customerName: document.getElementById('resName').value,
        customerPhone: document.getElementById('resPhone').value,
        date: document.getElementById('resDate').value,
        time: document.getElementById('resTime').value,
        guestCount: parseInt(document.getElementById('resGuests').value),
        status: 'confirmed',
        createdAt: new Date().toISOString()
    };
    
    // Mark table as reserved
    const table = tables.find(t => t.number === reservation.tableNumber);
    if (table) table.status = 'reserved';
    
    reservations.push(reservation);
    closeModal();
    renderReservations();
    alert('Reservation created successfully!');
}

function renderReservations() {
    let html = '';
    reservations.forEach(res => {
        html += `
            <div class="bg-white p-4 rounded-xl shadow">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="font-bold">${res.customerName}</h3>
                        <p class="text-gray-600 text-sm">Table ${res.tableNumber} ‚Ä¢ ${res.guestCount} guests</p>
                        <p class="text-gray-600 text-sm">${res.date} at ${res.time}</p>
                    </div>
                    <div class="flex gap-2">
                        <span class="px-3 py-1 ${res.status === 'confirmed' ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'} rounded">
                            ${res.status}
                        </span>
                        <button onclick="cancelReservation('${res.id}')" class="px-3 py-1 bg-red-100 text-red-700 rounded">Cancel</button>
                    </div>
                </div>
            </div>
        `;
    });
    document.getElementById('reservationsList').innerHTML = html;
}

function cancelReservation(id) {
    if (confirm('Are you sure you want to cancel this reservation?')) {
        const reservation = reservations.find(r => r.id === id);
        if (reservation) {
            reservation.status = 'cancelled';
            // Free the table
            const table = tables.find(t => t.number === reservation.tableNumber);
            if (table) table.status = 'free';
        }
        renderReservations();
    }
}

function renderOrders() {
    const search = document.getElementById('orderSearch')?.value.toLowerCase() || '';
    let html = '';
    
    orders.forEach(order => {
        if (search && !order.tableNumber.toString().includes(search) && 
            !order.customerName.toLowerCase().includes(search)) return;
            
        html += `
            <div class="bg-white p-4 rounded-xl shadow">
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <h3 class="font-bold">Table ${order.tableNumber} ‚Ä¢ ${order.customerName}</h3>
                        <p class="text-gray-600 text-sm">${order.orderNumber}</p>
                    </div>
                    <span class="px-3 py-1 ${order.status === 'completed' ? 'bg-green-100 text-green-700' : order.status === 'preparing' ? 'bg-yellow-100 text-yellow-700' : 'bg-blue-100 text-blue-700'} rounded">
                        ${order.status}
                    </span>
                </div>
                <div class="border-t pt-4">
                    ${order.items.map(item => `
                        <div class="flex justify-between mb-2">
                            <span>${item.name} √ó ${item.quantity}</span>
                            <span>‚Çπ${item.price * item.quantity}</span>
                        </div>
                    `).join('')}
                    <div class="flex justify-between font-bold border-t pt-2 mt-2">
                        <span>Total</span>
                        <span>‚Çπ${order.total}</span>
                    </div>
                </div>
                <div class="flex gap-2 mt-4">
                    ${order.status === 'preparing' ? `<button onclick="updateOrderStatus('${order.id}', 'completed')" class="px-3 py-1 bg-green-600 text-white rounded">Mark Completed</button>` : ''}
                    <button onclick="viewOrderDetails('${order.id}')" class="px-3 py-1 bg-blue-600 text-white rounded">View Details</button>
                </div>
            </div>
        `;
    });
    document.getElementById('ordersList').innerHTML = html;
}

function updateOrderStatus(id, status) {
    const order = orders.find(o => o.id === id);
    if (order) {
        order.status = status;
        renderOrders();
    }
}

function viewOrderDetails(id) {
    const order = orders.find(o => o.id === id);
    if (order) {
        alert(`Order Details:\n\nOrder: ${order.orderNumber}\nTable: ${order.tableNumber}\nCustomer: ${order.customerName}\nPhone: ${order.customerPhone}\nStatus: ${order.status}\nTotal: ‚Çπ${order.total}`);
    }
}

function renderHistory() {
    const search = document.getElementById('historySearch')?.value.toLowerCase() || '';
    let html = '';
    
    if (historyFilter === 'table') {
        document.getElementById('btnTable').classList.add('bg-blue-600', 'text-white');
        document.getElementById('btnTable').classList.remove('bg-gray-300');
        document.getElementById('btnName').classList.remove('bg-blue-600', 'text-white');
        document.getElementById('btnName').classList.add('bg-gray-300');
        
        // Group orders by table
        const tableGroups = {};
        orders.forEach(order => {
            if (search && !order.tableNumber.toString().includes(search)) return;
            
            if (!tableGroups[order.tableNumber]) {
                tableGroups[order.tableNumber] = [];
            }
            tableGroups[order.tableNumber].push(order);
        });
        
        for (const [tableNumber, tableOrders] of Object.entries(tableGroups)) {
            const total = tableOrders.reduce((sum, o) => sum + o.total, 0);
            html += `
                <div class="bg-white p-4 rounded-xl shadow">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-lg">Table ${tableNumber}</h3>
                        <span class="font-bold">‚Çπ${total}</span>
                    </div>
                    ${tableOrders.map(order => `
                        <div class="border-l-2 border-blue-500 pl-3 mb-3">
                            <div class="flex justify-between">
                                <span class="font-medium">${order.orderNumber}</span>
                                <span>‚Çπ${order.total}</span>
                            </div>
                            <p class="text-gray-600 text-sm">${new Date(order.createdAt).toLocaleDateString()} ‚Ä¢ ${order.customerName}</p>
                        </div>
                    `).join('')}
                </div>
            `;
        }
    } else {
        document.getElementById('btnName').classList.add('bg-blue-600', 'text-white');
        document.getElementById('btnName').classList.remove('bg-gray-300');
        document.getElementById('btnTable').classList.remove('bg-blue-600', 'text-white');
        document.getElementById('btnTable').classList.add('bg-gray-300');
        
        // Group orders by customer name
        const nameGroups = {};
        orders.forEach(order => {
            if (search && !order.customerName.toLowerCase().includes(search)) return;
            
            if (!nameGroups[order.customerName]) {
                nameGroups[order.customerName] = [];
            }
            nameGroups[order.customerName].push(order);
        });
        
        for (const [customerName, customerOrders] of Object.entries(nameGroups)) {
            const total = customerOrders.reduce((sum, o) => sum + o.total, 0);
            html += `
                <div class="bg-white p-4 rounded-xl shadow">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-lg">${customerName}</h3>
                        <span class="font-bold">‚Çπ${total}</span>
                    </div>
                    ${customerOrders.map(order => `
                        <div class="border-l-2 border-green-500 pl-3 mb-3">
                            <div class="flex justify-between">
                                <span class="font-medium">Table ${order.tableNumber}</span>
                                <span>‚Çπ${order.total}</span>
                            </div>
                            <p class="text-gray-600 text-sm">${new Date(order.createdAt).toLocaleDateString()} ‚Ä¢ ${order.orderNumber}</p>
                        </div>
                    `).join('')}
                </div>
            `;
        }
    }
    
    document.getElementById('historyList').innerHTML = html || '<p class="text-gray-500 text-center py-8">No orders found</p>';
}

// Initialize the application when page loads
window.onload = function() {
    init();
};

</script>
